<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="BSA">
<title>processing_instructions • BSA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.2/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.2/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.2/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="processing_instructions">
<meta property="og:description" content="BSA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BSA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/BSA2.html">BSA2</a>
    <a class="dropdown-item" href="../articles/BSA2_plots.html">BSA2_plots</a>
    <a class="dropdown-item" href="../articles/processing_instructions.html">processing_instructions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/cmatKhan/BSA/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>processing_instructions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cmatKhan/BSA/blob/HEAD/vignettes/processing_instructions.Rmd" class="external-link"><code>vignettes/processing_instructions.Rmd</code></a></small>
      <div class="d-none name"><code>processing_instructions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="alignment">Alignment<a class="anchor" aria-label="anchor" href="#alignment"></a>
</h2>
<p>The first step is to align the reads. I normally name the samples according with what they are, so that’s are represented in the fastq file. The first step for me is to createan ID file containing name of the sample and file full address, separated by space.You can change that to other sep in the script. I was considering changing the sep toa comma, to be easily exported from a Excel. But haven’t done that. Having the name of the sample in the fastq file allows me to use a simple script tomake this ID file. For BSA2 samples, you have to look at the excel sheet DanielSeqDatabase.xlsx to find where the files of interest are. Then we would just do this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /lts/mblab/personal/daniel.agustinho/raw/BSA2/<span class="pp">*</span>.fastq.gz /scratch/<span class="va">$USER</span>/bsa2_fastq</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /scratch/<span class="va">$USER</span>/bsa2 </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">/scratch/mblab/daniel.agustinho/tools/IDmaker.sh</span> ID</span></code></pre></div>
<div class="section level3">
<h3 id="idmaker-sh">IDmaker.sh<a class="anchor" aria-label="anchor" href="#idmaker-sh"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[chasem@login</span> ~]$ cat /scratch/mblab/daniel.agustinho/tools/IDmaker.sh</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="va">output</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="pp">*</span>R1_001.fastq.gz <span class="kw">|</span><span class="fu">awk</span> <span class="at">-F</span> <span class="st">'_'</span> <span class="st">'{print $3}'</span> <span class="op">&gt;</span> temp1.txt</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-d</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">"</span>/<span class="pp">*</span>R1_001.fastq.gz <span class="op">&gt;</span> temp2.txt</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="at">-d</span> <span class="st">" "</span> temp1.txt temp2.txt <span class="op">&gt;</span> <span class="va">$output</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> temp1.txt temp2.txt</span></code></pre></div>
<p>This will create a file called ID containing the name of the sample. Copy that and the fastq.gz files to your analysis folder in scratch. Create some useful folders that will beused by the scripts. Call alignments with NGM (you can use another). Observe thatthe script has already the “KN99 reference” that’s older. Feel free to adjust that inyour own copied version of the script.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> bams freebayes/indvVCF </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> raw log SVssbatch <span class="at">--array</span><span class="op">=</span>1-<span class="va">$(</span><span class="fu">wc</span> <span class="at">-l</span> <span class="op">&lt;</span> ID<span class="va">)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">/scratch/mblab/daniel.agustinho/tools/ngm.job</span> ID bams KN99</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ngm-job">ngm.job<a class="anchor" aria-label="anchor" href="#ngm-job"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[chasem@login</span> ~]$ cat /scratch/mblab/daniel.agustinho/tools/IDmaker.sh</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="va">output</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="pp">*</span>R1_001.fastq.gz <span class="kw">|</span><span class="fu">awk</span> <span class="at">-F</span> <span class="st">'_'</span> <span class="st">'{print $3}'</span> <span class="op">&gt;</span> temp1.txt</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-d</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">"</span>/<span class="pp">*</span>R1_001.fastq.gz <span class="op">&gt;</span> temp2.txt</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="ex">paste</span> <span class="at">-d</span> <span class="st">" "</span> temp1.txt temp2.txt <span class="op">&gt;</span> <span class="va">$output</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> temp1.txt temp2.txt</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="ex">[chasem@login</span> ~]$ cat /scratch/mblab/daniel.agustinho/tools/ngm.job</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -o log/ngm-%a-out</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -e log/ngm-%a-err</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=12000</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> lumpy-sv</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> bamaddrg</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> nextgenmap/0.5.3 </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> yaha/0.1.83</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> picard-tools/2.10.0</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> freebayes/1.1.0</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> vcftools/0.1.14</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> snpeff/4.1</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> tabix</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co"># $1 is the list of IDs and sequencing tags, $2 is the directory with the FASTQ files, $3 is the directory to output to</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># No seq Folder on this version</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="va">outputDir</span><span class="op">=</span><span class="va">$2</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="va">genome</span><span class="op">=</span><span class="va">$3</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="va">line</span><span class="op">=</span><span class="va">$SLURM_ARRAY_TASK_ID</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="va">strainLine</span><span class="op">=</span><span class="kw">`</span><span class="fu">sed</span> <span class="st">"</span><span class="va">${line}</span><span class="st">q;d"</span> <span class="va">${file}</span><span class="kw">`</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="va">Sample</span><span class="op">=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">${strainLine}</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-d</span> <span class="st">" "</span> <span class="at">-f</span> 2<span class="kw">`</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="va">name</span><span class="op">=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">${strainLine}</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-d</span> <span class="st">" "</span> <span class="at">-f</span> 1<span class="kw">`</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the preset genomes: KN99, H99 and mouse</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$genome</span> <span class="ot">=</span>  <span class="st">"H99"</span> <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a> <span class="va">reference</span><span class="op">=</span><span class="st">"/scratch/mblab/daniel.agustinho/references/crNeoH99.fasta"</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a> <span class="bu">echo</span> <span class="st">"You chose the H99 genome as a reference genome: </span><span class="va">${reference}</span><span class="st">"</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="bu">[</span> <span class="va">$genome</span> <span class="ot">=</span> <span class="st">"KN99"</span> <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a> <span class="va">reference</span><span class="op">=</span><span class="st">"/scratch/mblab/daniel.agustinho/references/crNeoKN99.fasta"</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a> <span class="bu">echo</span> <span class="st">"You chose the KN99 genome as a reference genome: </span><span class="va">${reference}</span><span class="st">"</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="bu">[</span> <span class="va">$genome</span> <span class="ot">=</span> <span class="st">"mouse"</span> <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a> <span class="va">reference</span><span class="op">=</span><span class="st">"/scratch/mblab/daniel.agustinho/references/mm10.fa"</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a> <span class="bu">echo</span> <span class="st">"You chose the MM10 mouse genome as a reference genome: </span><span class="va">${reference}</span><span class="st">"</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"You chose a genome different from the preset ones (KN99, H99 or Mouse MM10)."</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="va">reference</span><span class="op">=</span><span class="va">$genome</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="va">$reference</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="va">${outputDir}</span>/splitReads</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> freebayes/indvVCF/snpEff/results/</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="va">file2</span><span class="op">=</span><span class="va">${Sample</span><span class="op">/</span><span class="ss">R1_001.fastq</span><span class="op">/</span>R2_001.fastq<span class="va">}</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-f</span> <span class="va">$file2</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">#This aligns to reference and converts to ngm.bam, plus indexes the bam</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="ex">ngm</span> <span class="at">-X</span> 100000000 <span class="at">-t</span> 5 <span class="at">--rg-id</span> <span class="va">${name}</span> <span class="at">--rg-sm</span> <span class="va">${name}</span> <span class="at">-1</span> <span class="va">${Sample}</span> <span class="at">-2</span> <span class="va">${file2}</span> <span class="at">-r</span> <span class="va">$reference</span> <span class="kw">|</span><span class="ex">samtools</span> view <span class="at">-bh</span> <span class="at">-</span> <span class="kw">|</span><span class="ex">samtools</span> sort <span class="at">-</span> <span class="kw">|</span><span class="ex">samtools</span> rmdup <span class="at">-</span> <span class="va">${outputDir}</span>/<span class="va">${name}</span>.ngm.bam</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="co">#This aligns to reference and converts to ngm.bam, plus indexes the bam</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="ex">ngm</span> <span class="at">-X</span> 100000000 <span class="at">-t</span> 5 <span class="at">--rg-id</span> <span class="va">${name}</span> <span class="at">--rg-sm</span> <span class="va">${name}</span> <span class="at">-q</span> <span class="va">${Sample}</span> <span class="at">-r</span> <span class="va">$reference</span> <span class="kw">|</span><span class="ex">samtools</span> view <span class="at">-bh</span> <span class="at">-</span> <span class="kw">|</span><span class="ex">samtools</span> sort <span class="at">-</span> <span class="kw">|</span><span class="ex">samtools</span> rmdup <span class="at">-</span> <span class="va">${outputDir}</span>/<span class="va">${name}</span>.ngm.bam</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> index <span class="va">${outputDir}</span>/<span class="va">${name}</span>.ngm.bam</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="co">#This gets the split reads from the bam into a fastq for YAHA</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">-h</span> <span class="va">${outputDir}</span>/<span class="va">${name}</span>.ngm.bam <span class="kw">|</span> <span class="ex">/opt/apps/lumpy-sv/lumpy-sv-0.2.13/scripts/split_unmapped_to_fasta.pl</span> <span class="at">-b</span> 20 <span class="op">&gt;</span><span class="va">${outputDir}</span>/splitReads/<span class="va">${name}</span>.split.fq</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="ex">yaha</span> <span class="at">-t</span> 15 <span class="at">-x</span> <span class="va">${reference</span><span class="op">/</span><span class="ss">fasta</span><span class="op">/</span>X11_01_02000S<span class="va">}</span> <span class="at">-q</span> <span class="va">${outputDir}</span>/splitReads/<span class="va">${name}</span>.split.fq <span class="at">-osh</span> stdout  <span class="at">-M</span> 15 <span class="at">-H</span> 2000 <span class="at">-L</span> 11 <span class="kw">|</span><span class="ex">samtools</span> view <span class="at">-Sbh</span> <span class="at">-</span> <span class="kw">|</span><span class="ex">samtools</span> sort <span class="at">-</span> <span class="op">&gt;</span> <span class="va">${outputDir}</span>/splitReads/<span class="va">${name}</span>.split.ngm.bam</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="co">#java -jar /opt/apps/picard-tools/2.10.0/picard.jar MergeSamFiles I=${outputDir}/${name}.ngm.bam I=${outputDir}/splitReads/${name}.split.ngm.bam O=${outputDir}/${name}.merged.ngm.bam USE_THREADING=true AS=true MERGE_SEQUENCE_DICTIONARIES=true</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> /scratch/mblab/daniel.agustinho/tools/repo/PicardTools/picard.jar MergeSamFiles I=<span class="va">${outputDir}</span>/<span class="va">${name}</span>.ngm.bam I=<span class="va">${outputDir}</span>/splitReads/<span class="va">${name}</span>.split.ngm.bam O=<span class="va">${outputDir}</span>/<span class="va">${name}</span>.merged.ngm.bam USE_THREADING=true AS=true MERGE_SEQUENCE_DICTIONARIES=true</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a><span class="ex">bamaddrg</span> <span class="at">-s</span> <span class="va">${name}</span> <span class="at">-b</span> <span class="va">${outputDir}</span>/<span class="va">${name}</span>.merged.ngm.bam <span class="op">&gt;</span> <span class="va">${outputDir}</span>/<span class="va">${name}</span>.merged.tagged.ngm.bam</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="co">#bamaddrg -s ${name} -b ${outputDir}/${name}.ngm.bam &gt; ${outputDir}/${name}.tagged.ngm.bam</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> index <span class="va">${outputDir}</span>/<span class="va">${name}</span>.merged.tagged.ngm.bam</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">${outputDir}</span>/<span class="va">${name}</span>.ngm.bam.bai</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">${outputDir}</span>/<span class="va">${name}</span>.merged.ngm.bam</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">${outputDir}</span>/<span class="va">${name}</span>.ngm.bam</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> /scratch/mblab/daniel.agustinho/tools/cnvnator.job <span class="va">$file</span> bams/ SVs/ <span class="va">$line</span> <span class="va">$genome</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> /scratch/mblab/daniel.agustinho/tools/delly.sh <span class="va">$file</span> bams/ SVs/ <span class="va">$reference</span> <span class="va">$line</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a><span class="ex">freebayes</span> <span class="at">-F</span> 0.75 <span class="at">-!</span> 5 <span class="at">-p</span> 1 <span class="at">--min-mapping-quality</span> 30 <span class="at">-f</span> <span class="va">$reference</span> <span class="va">${outputDir}</span>/<span class="va">${name}</span>.merged.tagged.ngm.bam <span class="op">&gt;</span> freebayes/indvVCF/<span class="va">$name</span>.vcf </span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-jar</span> /home/daniel.agustinho/miniconda3/pkgs/snpeff-4.3.1t-0/share/snpeff-4.3.1t-0/snpEff.jar <span class="at">-c</span> /home/daniel.agustinho/miniconda3/pkgs/snpeff-4.3.1t-0/share/snpeff-4.3.1t-0/snpEff.config <span class="at">-s</span> snpEff/results/<span class="va">${name}</span>.html <span class="at">-v</span> ASM221672v1 freebayes/indvVCF/<span class="va">$name</span>.vcf <span class="op">&gt;</span> freebayes/indvVCF/<span class="va">$name</span>.ann.vcf</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a><span class="ex">bgzip</span> freebayes/indvVCF/<span class="va">$name</span>.ann.vcf</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a><span class="ex">tabix</span> freebayes/indvVCF/<span class="va">$name</span>.ann.vcf.gz</span></code></pre></div>
<p>This will create alignment files (bam and bai) for each sample in the bams folder. Itwill also call CNVnator for each one of them, generating tables and CNV VCFs with the same sample names in SVs/indvCNVs folder. It will call Delly for SVs, in theSVs/delly folder. But recently I observed that Delly sucks. I recommend using Manta instead. It will also call individual VCFs using freebayes and annotating the withSNPEff in the freebayes/indvVCF folder. If you have any problems or errors, check the log/ folder</p>
</div>
</div>
<div class="section level2">
<h2 id="variant-calling-for-bsa-analysis">Variant calling for BSA analysis<a class="anchor" aria-label="anchor" href="#variant-calling-for-bsa-analysis"></a>
</h2>
<p>When this is finished, you should call freebayes again for the population VCF. First, create a list of bams, and use those for the freebayes call</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-d</span> <span class="st">"</span><span class="va">$PWD</span><span class="st">"</span>/bams/<span class="pp">*</span>.merged.tagged.ngm.bam <span class="op">&gt;&gt;</span> bamList</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/scratch/mblab/daniel.agustinho/tools/sbatch_maker/freebayes.bamList.sbatch</span> <span class="dt">\</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  KN99 <span class="dt">\</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  BSA2 <span class="dt">\</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  bamList</span></code></pre></div>
<div class="section level3">
<h3 id="freebayes-bamlist-sbatch">freebayes.bamList.sbatch<a class="anchor" aria-label="anchor" href="#freebayes-bamlist-sbatch"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[chasem@login</span> ~]$ cat /scratch/mblab/daniel.agustinho/tools/sbatch_maker/freebayes.bamList.sbatch</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -o freebayes-out</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -e freebayes-err</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=50000</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mail-type=</span><span class="re">END</span><span class="co">,FAIL</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --array 1-17%17</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> freebayes/1.1.0</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> vcftools/0.1.14</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="va">genome</span><span class="op">=</span><span class="va">$1</span> <span class="co"># Either H99 or KN99</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="va">name</span><span class="op">=</span><span class="va">$2</span> <span class="co">#This is the name of the clinical strain used for basis of the comparison</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="va">bamList</span><span class="op">=</span><span class="va">$3</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$genome</span> <span class="ot">=</span>  <span class="st">"H99"</span> <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a> <span class="va">reference</span><span class="op">=</span><span class="st">"/scratch/mblab/daniel.agustinho/references/crNeoH99.fasta"</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="bu">[</span> <span class="va">$genome</span> <span class="ot">=</span> <span class="st">"KN99"</span> <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a> <span class="va">reference</span><span class="op">=</span><span class="st">"/scratch/mblab/daniel.agustinho/references/crNeoKN99.fasta"</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Valid genomes are H99 or KN99. Review your 4th  argument."</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exit</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="ex">/scratch/mblab/daniel.agustinho/tools/freebayes.bam_list.job</span> <span class="va">$reference</span> <span class="va">$name</span> <span class="va">$bamList</span> <span class="va">${SLURM_ARRAY_TASK_ID}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="freebayes-bam_list-job">freebayes.bam_list.job<a class="anchor" aria-label="anchor" href="#freebayes-bam_list-job"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[chasem@login</span> ~]$ cat /scratch/mblab/daniel.agustinho/tools/freebayes.bam_list.job</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=60G</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> freebayes/1.1.0</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> vcftools/0.1.14</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="va">reference</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="va">name</span><span class="op">=</span><span class="va">$2</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="va">bamList</span><span class="op">=</span><span class="va">$3</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="va">region</span><span class="op">=</span><span class="va">$4</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="va">chrom</span><span class="op">=</span><span class="va">$(</span><span class="fu">gawk</span> <span class="st">'{print $1}'</span> <span class="va">$reference</span>.fai <span class="kw">|</span><span class="fu">sed</span> <span class="st">"</span><span class="va">${region}</span><span class="st">q;d"</span><span class="va">)</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="va">parentVCF</span><span class="op">=</span><span class="va">$5</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$parentVCF</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> freebayes</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-z</span> <span class="va">$5</span>  <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a> <span class="ex">freebayes</span> <span class="at">-!</span> 5 <span class="at">-F</span> 0.75 <span class="at">-p</span> 1 <span class="at">--min-mapping-quality</span> 30 <span class="at">-r</span> <span class="va">$chrom</span> <span class="at">-f</span> <span class="va">$reference</span> <span class="at">--bam-list</span> <span class="va">$bamList</span> <span class="op">&gt;</span> freebayes/freebayes.<span class="va">$name</span>.<span class="va">$chrom</span>.vcf</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a> <span class="ex">freebayes</span> <span class="at">-l</span> <span class="at">-@</span> <span class="va">$parentVCF</span> <span class="at">-!</span> 5 <span class="at">-F</span> 0.75 <span class="at">-p</span> 1 <span class="at">--min-mapping-quality</span> 30 <span class="at">-r</span> <span class="va">$chrom</span> <span class="at">-f</span> <span class="va">$reference</span> <span class="at">--bam-list</span> <span class="va">$bamList</span> <span class="op">&gt;</span> freebayes/freebayes.<span class="va">$name</span>.<span class="va">$chrom</span>.vcf</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code></pre></div>
<p>This will create one VCF file per chromosome in the freebayes folder. Check if it ransmoothly (some samples may require more memmory), and if it did, we will merge allof those together using the VCFmerger.sh script. This script merges them in one bigVCF and deletes the VCF for individual chromosomes, so be sure the previous stepran smoothly. It also calls the next script, that makes tables from the VCF file that canbe easily read by the R script that will do the analysis.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scratch/mblab/daniel.agustinho/tools/VCFmerger.sh</span> BSA2</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="vcfmerger-sh">VCFmerger.sh<a class="anchor" aria-label="anchor" href="#vcfmerger-sh"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[chasem@login</span> ~]$ cat /scratch/mblab/daniel.agustinho/tools/VCFmerger.sh </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -o log/VCFmerger_%j-out</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -e log/VCFmerger_%j-err</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=50G</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> vcftools/0.1.14</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ex">ml</span> R</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="va">name</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> freebayes/VCFtables</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="st">'#'</span> freebayes/freebayes.<span class="va">${name}</span>.chr1.vcf<span class="op">&gt;</span>freebayes/<span class="va">$name</span>.vcf</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> chr<span class="dt">{</span><span class="dv">1</span><span class="dt">..</span><span class="dv">14</span><span class="dt">}</span> chrM NAT G418</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span> <span class="fu">cat</span> freebayes/freebayes.<span class="va">${name}</span>.<span class="va">$i</span>.vcf <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-v</span> <span class="st">'^#'</span> <span class="op">&gt;&gt;</span> freebayes/<span class="va">$name</span>.vcf</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="ex">vcftools</span> <span class="at">--vcf</span> freebayes/<span class="va">${name}</span>.vcf <span class="at">--out</span> freebayes/<span class="va">${name}</span>.dusted.vcf <span class="at">--exclude-bed</span> /scratch/mblab/daniel.agustinho/references/dustmasked.KN99.bed <span class="at">--recode</span> <span class="at">--recode-INFO-all</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> freebayes/<span class="va">$name</span>.dusted.vcf.recode.vcf freebayes/<span class="va">$name</span>.clean.vcf</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> freebayes/freebayes.<span class="va">${name}</span>.chr<span class="pp">*</span>.vcf</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> freebayes/<span class="va">$name</span>.dusted.vcf.recode.vcf</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> freebayes/<span class="va">${name}</span>.vcf</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Starting the sorting.</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="at">-e</span> <span class="st">"77s/#//"</span> freebayes/<span class="va">$name</span>.clean.vcf <span class="op">&gt;</span> freebayes/<span class="va">$name</span>.clean.vcf.test</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> /scratch/mblab/daniel.agustinho/tools/vcfSorter.R freebayes/<span class="va">$name</span>.clean.vcf.test</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="st">'^##'</span> freebayes/<span class="va">$name</span>.clean.vcf  <span class="op">&gt;</span> freebayes/<span class="va">$name</span>.sorted.vcf <span class="co"># ${file/clean.vcf/sorted.vcf}</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> data.vcf <span class="op">&gt;&gt;</span> freebayes/<span class="va">$name</span>.sorted.vcf</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="at">-e</span> <span class="st">"77s/CHROM/#CHROM/"</span> freebayes/<span class="va">$name</span>.sorted.vcf <span class="op">&gt;</span> freebayes/<span class="va">$name</span>.IGV.vcf</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> data.vcf</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> freebayes/<span class="va">$name</span>.clean.vcf.test freebayes/<span class="va">$name</span>.clean.vcf freebayes/<span class="va">$name</span>.sorted.vcf</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="ex">/scratch/mblab/daniel.agustinho/tools/VCF_tabler.sh</span> freebayes/<span class="va">$name</span>.IGV.vcf freebayes/VCFtables</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> freebayes/VCFtables/.txt</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="ex">/scratch/mblab/daniel.agustinho/tools/strainAnalyzer.sh</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="ex">./popAnalyzer.sh</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="statistical-analysis">Statistical analysis<a class="anchor" aria-label="anchor" href="#statistical-analysis"></a>
</h2>
<p><strong>NOTE</strong> these scripts have been incorporated into the <code>R/</code> directory or other vignettes. Below is from Daniel:</p>
<p>That should create a BSA2.IGV.vcf file in the freebayes folder. You can look at it on IGV etc. It will also create a folder freebayes/VCFtables that contains one table (txtfile) for each sample that was called used as input for freebayes. Transfer those toyour personal laptop to analyse using the R script:</p>
<ul>
<li><code>BSA2Analysis.R</code></li>
</ul>
<p>Adjust the script to get the input from the proper folder (where the txt files you copied from the server are). This will generate a BSA2.RData file containing the analysis. You can use it in the second R script to make plots.</p>
<ul>
<li><code>BSA2plots.R</code></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
